{{ template "header" }}
<hr>
<div class="row ">
    <div class="col">
      {{ template "creator" . }}
    </div>
    <div class="col-6 text-light bg-secondary">
       <h3 class="sticky-sm-top">Deine Termine ab dem {{.SelectedDate.Format "2006-01-02"}}</h3>
        <form action="/user/view/list?selDatum" method="POST" id="dateSelector" role="form" class="row mb-3 p-3  needs-validation" novalidate>
            <div>
                <label for="selDate" class="col-sm-2 ">Wähle Datum</label>
                <input type="date" class="form-control" name="selDate" id="selDate" required>
                <div class="col-12  p-3">
                    <button type="submit" class="btn btn-light float-end" onclick="validateForm('dateSelector')">Datum wählen</button>
                </div>
            </div>
        </form>
        {{range $index, $dayEntry := .GetEntries}}
        <div  class="card text-dark bg-light mb-3">
            <div class="card-body">
                <h5 class="card-title">{{.Title}}</h5>
                <h6 class="card-subtitle mb-2 text-muted">{{.Description}}</h6>
                <!-------Filter Reccuring String-Repräsentation----->
                {{$rep := ""}}
                {{if eq .Recurring 0}}
                    {{$rep = "täglich"}}
                {{else}}
                    {{if eq .Recurring 1}}
                {{$rep = "wöchentlich"}}
                    {{else}}
                        {{if eq .Recurring 2}}
                {{$rep = "monatlich"}}
                        {{else}}
                            {{if eq .Recurring 3}}
                {{$rep = "jährlich"}}
                            {{else}}
                {{$rep =  "niemals"}}
                            {{end}}
                        {{end}}
                    {{end}}
                {{end}}
                <div class="card-text">
                    <ul>
                        <li>
                            <b>Wiederholung: </b>{{$rep}}
                        </li>
                        <li>
                            <b>Nächsten Vorkommen: </b> {{range $occur := $.NextOccurrences $dayEntry}} {{ $occur.Format "2006-01-02"}},  {{end}}
                        </li>
                        <li>
                            <b>Startdatum: </b>{{.Date.Format "2006-01-02"}}
                        </li>
                        <li>
                            <b>Enddatum: </b>{{.EndDate.Format "2006-01-02"}}
                        </li>
                    </ul>
            </div>
                <!---button zum Bearbeiten des Termins--->
                <button type="button" class="btn btn-link" onclick="editTermin(new Termin({{.Title}},{{.Description}},{{.Recurring}},{{.Date}},{{.EndDate}}))">bearbeiten
                </button>
            </div>
        </div>
        {{end}}
        <div>
            <ul class="pagination ml-2">
                <li><button type="button" class="btn btn-sm btn-light" onclick="JumpPageBack()"> Zurück </button></li>
                <li> {{.CurrentPage}} von {{.RequiredPages}} </li>
                <li><button type="button" class="btn btn-sm btn-light" onclick="JumpPageForward()"> Vor </button></li>
            </ul>
        </div>
    </div>

<!----------Rechte Spalte: wählen der Einträge pro Seite------------>
    <div class="col">
        <div class="dropdown  p-2">
            <button class="btn btn-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                Einträge pro Seite
            </button>
            <ul class="dropdown-menu dropdown-menu-dark " aria-labelledby="dropdownMenuButton2">
                <li class="dropdown-item" onclick="entrySelection(1)">5</li>
                <li class="dropdown-item" onclick="entrySelection(2)">10</li>
                <li class="dropdown-item" onclick="entrySelection(3)">15</li>
            </ul>
        </div>
    </div>
</div>
{{ template "footer" . }}
{{template "creatorScript" .}}

<!--------------------Hier folgt benötigter JavaScript-Code--------------------------->
<script>

    // entrySelection
    // hier wird eine Get request gestellt, um die gewünschte Anzahl an Einträgen pro Seite zu erhalten
    function entrySelection(amount) {
        var xhttp = new XMLHttpRequest();
        xhttp.onload = function () {
            location.reload();
        }
        requestString = String("?Eintraege=" + amount)
        xhttp.open("GET", requestString);
        xhttp.send();
    }
    // JumpPageBack
    // hier wird eine Get request gestellt, um eine Seite zurück zu springen
    function JumpPageBack() {
        var xhttp = new XMLHttpRequest();
        xhttp.onload = function () {
            location.reload();
        }
        requestString = String("?Seite=-1")
        xhttp.open("GET", requestString);
        xhttp.send();
    }
    // JumpPageForward
    // hier wird eine Get request gestellt, um eine Seite vor zu springen
    function JumpPageForward() {
        var xhttp = new XMLHttpRequest();
        xhttp.onload = function () {
            location.reload();
        }
        requestString = String("?Seite=+1")
        xhttp.open("GET", requestString);
        xhttp.send();
    }


    // Termin
    // hier wird ein Objekt Termin erstellt, welches für die Terminbearbeitung benötigt wird
    function Termin(title, description, recurring, date, endDate) {
        this.Title = title;
        this.Description = description;
        this.Recurring = recurring;
        this.Date = date;
        this.EndDate = endDate;
    }
</script>